<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="Aliy's Store | Venta por catálogo" />
  <meta property="og:description" content="Hola, soy Alicia y te ayudo a encontrar el producto perfecto para ti" />
  <meta property="og:image" content="https://aliysstore.github.io/Aliy-s-Store/img/perfil.jpg" />
  <meta property="og:url" content="https://aliysstore.github.io/Aliy-s-Store" />
  <meta property="og:type" content="website" />
  
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Aliy's Store | Venta por catálogo" />
  <meta name="twitter:description" content="Hola, soy Alicia y te ayudo a encontrar el producto perfecto para ti" />
  <meta name="twitter:image" content="https://aliysstore.github.io/Aliy-s-Store/img/perfil.jpg" />
    
  <meta name="google-site-verification" content="OJZCwNFA7qoGBq9oi98SAslM7bHUFF-6A_8wYiELeVU" />
  
  <title>Aliy's Store | Calzado, ropa y accesorios por catálogo</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&family=Oswald:wght@400;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="img/favicon.ico" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/isotope-layout@3/dist/isotope.pkgd.min.js"></script>
  <script src="https://unpkg.com/imagesloaded@5/imagesloaded.pkgd.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    // Define el estado de consentimiento predeterminado como "denegado"
    // Esto debe ejecutarse antes de que se cargue la etiqueta de Google Analytics.
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('consent', 'default', {
      'ad_storage': 'denied',
      'analytics_storage': 'denied',
      'wait_for_update': 500 // Espera hasta 500ms para la actualización del consentimiento
    });
  </script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZW7YPM60FN"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-ZW7YPM60FN');
  </script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'md-primary': '#FF5277',
            'md-on-primary': '#FFFFFF',
            'md-primary-container': '#FFD9E2',
            'md-on-primary-container': '#660021',
            'md-secondary': '#5B4F7B',
            'md-on-secondary': '#FFFFFF',
            'md-secondary-container': '#E2D9FF',
            'md-on-secondary-container': '#1C0D37',
            'md-background': '#FFFBFE',
            'md-on-background': '#1D1B1F',
            'md-surface': '#FFFBFE',
            'md-on-surface': '#1D1B1F',
            'md-surface-variant': '#F3DDE3',
            'md-on-surface-variant': '#504147',
            'md-outline': '#837078',
            'md-surface-container-high': '#ECE6F0',
          },
          fontFamily: {
            'nunito': ['Nunito', 'sans-serif'],
            'oswald': ['Oswald', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <style>
    .catalog-grid {
      position: relative;
    }
    .catalog-item {
      width: calc(50% - 8px);
      margin-bottom: 16px;
      transition: transform 0.4s ease-out, opacity 0.4s ease-out;
    }
    .catalog-item.isotope-hidden {
      opacity: 0;
      transform: scale(0.001);
    }
    @media (min-width: 640px) {
       .catalog-item {
         width: calc(33.333% - 11px);
       }
    }
    @media (min-width: 1024px) {
       .catalog-item {
         width: calc(25% - 12px);
       }
    }
    @media (min-width: 1280px) {
       .catalog-item {
         width: calc(20% - 13px);
       }
    }
    @media (min-width: 1536px) {
       .catalog-item {
         width: calc(16.666% - 13px);
       }
    }
    .catalog-item .h-full {
      min-height: 250px;
    }
    .new-ribbon-wrapper {
        position: absolute;
        top: 0;
        right: 0;
        overflow: hidden;
        width: 100px;
        height: 100px;
        z-index: 10;
    }
    .new-ribbon-wrapper span {
        position: absolute;
        top: 20px;
        right: -30px;
        width: 120px;
        text-align: center;
        text-transform: uppercase;
        font-weight: bold;
        padding: 5px 0;
        background-color: #FF5277;
        color: #FFFFFF;
        transform: rotate(45deg);
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
    }
    /* Styles for the filter buttons */
    .filter-button {
      padding: 8px 16px;
      border-radius: 9999px;
      font-weight: bold;
      transition: all 0.3s ease;
      background-color: transparent;
      border: 1px solid #837078;
      color: #504147;
    }
    .filter-button.active, .filter-button:hover {
      background-color: #FF5277;
      border-color: #FF5277;
      color: #FFFFFF;
    }
    /* NEW STYLES FOR SIDEBAR LINKS */
    .sidebar-link {
      padding: 8px 12px;
      border-radius: 8px;
      transition: all 0.3s ease;
      background-color: transparent;
      color: #504147;
      border: 1px solid transparent; /* Added for consistency */
    }
    .sidebar-link.active, .sidebar-link:hover {
      background-color: #FF5277;
      color: #FFFFFF;
    }
    /* NUEVOS ESTILOS PARA EL BANNER DE CONSENTIMIENTO */
    .consent-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      background-color: #1d1b1f; /* Color de fondo oscuro */
      color: #fffafe; /* Color de texto claro */
      padding: 1.5rem;
      box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.2);
      transform: translateY(100%);
      transition: transform 0.5s ease-in-out;
    }
    .consent-banner.show {
      transform: translateY(0);
    }
    .consent-banner .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 9999px;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }
    .consent-banner .btn-accept {
      background-color: #FF5277;
      color: #FFFFFF;
      border: 1px solid #FF5277;
    }
    .consent-banner .btn-accept:hover {
      background-color: #C63A5E;
    }
    .consent-banner .btn-deny {
      background-color: transparent;
      color: #FFFFFF;
      border: 1px solid #FFFFFF;
    }
    .consent-banner .btn-deny:hover {
      background-color: #ffffff33;
    }

    /* Nuevos estilos para la modal de configuración */
    .consent-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.7);
        display: none; /* Oculto por defecto */
        z-index: 1001;
        justify-content: center;
        align-items: center;
    }

    .consent-modal.show {
        display: flex;
    }

    .consent-modal-content {
        background-color: #fff;
        padding: 2rem;
        border-radius: 12px;
        width: 90%;
        max-width: 500px;
        color: #1d1b1f;
        position: relative;
        max-height: 80vh; /* Limita la altura en pantallas pequeñas */
        display: flex; /* Nuevo: para organizar los elementos */
        flex-direction: column; /* Nuevo: para organizar los elementos */
    }

    .consent-modal-content h3 {
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 1rem;
    }
    
    .consent-modal-content p {
        margin-bottom: 1.5rem;
    }
    
    .consent-modal-content .close-btn {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.5rem;
        cursor: pointer;
    }

    .consent-options {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        overflow-y: auto; /* Nuevo: permite el scroll vertical */
        padding-right: 0.5rem; /* Nuevo: evita que el scrollbar se pegue a los bordes */
    }

    .consent-option {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
    }
    
    .consent-option .option-info {
        display: flex;
        flex-direction: column;
        flex-grow: 1; /* Allow text to take more space */
    }

    .consent-option .option-info h4 {
        font-weight: bold;
    }
    
    .consent-option .option-info p {
        font-size: 0.875rem;
        color: #504147;
    }

    .consent-option .toggle-container { /* New container for better spacing */
        margin-left: 1rem; /* Add some left margin to the toggle container */
    }

    .consent-option .toggle {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
    }
    
    .consent-option .toggle input {
        opacity: 0;
        width: 0;
        height: 0;
    }
    
    .consent-option .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 34px;
    }
    
    .consent-option .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }
    
    .consent-option input:checked + .slider {
        background-color: #FF5277;
    }
    
    .consent-option input:focus + .slider {
        box-shadow: 0 0 1px #FF5277;
    }
    
    .consent-option input:checked + .slider:before {
        transform: translateX(26px);
    }
    
  </style>
</head>
<body class="bg-md-background font-nunito text-md-on-background">
  <div class="flex flex-col min-h-screen">
    <header class="bg-md-surface-variant p-5 flex justify-between items-center">
      <div class="md:hidden">
        <button id="menu-button" class="text-md-on-surface-variant">
          <i class="fas fa-bars text-xl"></i>
        </button>
      </div>
      <div class="flex items-center space-x-2">
        <span class="md:hidden text-2xl font-oswald font-bold text-md-on-surface-variant">Aliy's Store</span>
        <span class="hidden md:block text-2xl font-oswald font-bold text-md-on-surface-variant">Aliy's Store | Venta por catálogo</span>
      </div>
      <a href="https://wa.me/5212285722185" id="whatsapp-contact-button" class="bg-transparent border border-md-outline text-md-on-surface-variant hover:bg-md-primary-container hover:text-md-on-primary-container active:bg-pink-100 font-bold py-2 px-4 rounded-full transition duration-300 flex items-center space-x-2">
        <i class="fab fa-whatsapp text-lg"></i>
        <span>Contacto</span>
      </a>
    </header>
    <div class="flex flex-col md:flex-row flex-grow">
      <div id="sidebar-overlay" class="fixed inset-0 bg-md-surface/50 hidden z-40 md:hidden"></div>
      <aside id="sidebar" class="bg-md-surface-variant p-5 flex-shrink-0 z-50 fixed inset-y-0 left-0 w-64 transform -translate-x-full transition-transform duration-300 md:relative md:w-48 md:transform-none md:block">
        <div class="text-right md:hidden">
            <button id="close-button" class="text-md-on-surface-variant">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <nav class="mt-8">
          <ul class="space-y-4">
            <li>
              <a href="#" class="sidebar-link block flex items-center space-x-2 active" data-filter="*">
                <i class="fas fa-th-large"></i>
                <span>Todo</span>
              </a>
            </li>
            <li>
              <a href="#" class="sidebar-link block flex items-center space-x-2" data-filter=".calzado">
                <i class="fas fa-shoe-prints"></i>
                <span>Calzado</span>
              </a>
              <ul class="ml-4 mt-2 space-y-2">
                <li><a href="#" class="sidebar-link block flex items-center space-x-2" data-filter=".dama"><i class="fas fa-female"></i><span>Dama</span></a></li>
                <li><a href="#" class="sidebar-link block flex items-center space-x-2" data-filter=".caballeros"><i class="fas fa-male"></i><span>Caballeros</span></a></li>
                <li><a href="#" class="sidebar-link block flex items-center space-x-2" data-filter=".niños"><i class="fas fa-child"></i><span>Niños</span></a></li>
                <li><a href="#" class="sidebar-link block flex items-center space-x-2" data-filter=".outlet"><i class="fas fa-tag"></i><span>Outlet</span></a></li>
              </ul>
            </li>
            <li>
              <a href="#" class="sidebar-link block flex items-center space-x-2" data-filter=".ropa">
                <i class="fas fa-tshirt"></i>
                <span>Ropa</span>
              </a>
            </li>
            <li>
              <a href="#" class="sidebar-link block flex items-center space-x-2" data-filter=".accesorios">
                <i class="fas fa-hat-cowboy"></i>
                <span>Accesorios</span>
              </a>
            </li>
            <li>
              <a href="#" class="sidebar-link block flex items-center space-x-2" data-filter=".hogar">
                <i class="fas fa-house"></i>
                <span>Hogar</span>
              </a>
            </li>
            <li>
              <a href="#" class="sidebar-link block flex items-center space-x-2" data-filter=".belleza-y-fragancias">
                <i class="fas fa-spa"></i>
                <span>Belleza y fragancias</span>
              </a>
            </li>
            <li>
              <a href="#" class="sidebar-link block flex items-center space-x-2" data-filter=".catalogos-especiales">
                <i class="fas fa-book-open"></i>
                <span>Catálogos especiales</span>
              </a>
            </li>
          </ul>
        </nav>
      </aside>
      <main class="flex-grow bg-md-background p-5">
        <div id="filter-container" class="mb-8 flex flex-wrap gap-2 justify-center">
        </div>
        
        <div id="catalog-grid" class="catalog-grid flex-wrap gap-4">
        </div>
      </main>
    </div>
    <footer class="bg-md-surface-container-high p-5 text-center text-md-on-surface-variant">
      Los catálogos y precios están sujetos a cambios sin previo aviso.
    </footer>
  </div>

  <div id="consent-banner" class="consent-banner">
    <div class="max-w-4xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
      <p class="text-sm text-center md:text-left">
        Este sitio utiliza cookies para mejorar la experiencia del usuario y analizar el tráfico.
        <a href="#" class="underline font-bold" id="link-politica-cookies">Política de cookies</a>.
      </p>
      <div class="flex gap-4">
        <button id="accept-all-cookies" class="btn btn-accept">Aceptar todas</button>
        <button id="open-consent-modal" class="btn btn-deny">Configurar</button>
      </div>
    </div>
  </div>

  <div id="consent-modal" class="consent-modal">
    <div class="consent-modal-content">
        <span class="close-btn" id="close-modal">&times;</span>
        <h3>Configuración de privacidad</h3>
        <p>Selecciona qué tipos de cookies deseas aceptar. Los cambios se aplicarán a tu próxima visita.</p>
        <div class="consent-options">
            <div class="consent-option">
                <div class="option-info">
                    <h4>Cookies necesarias</h4>
                    <p>Necesarias para el funcionamiento básico del sitio. No se pueden desactivar.</p>
                </div>
                <div class="toggle-container">
                    <div class="toggle">
                        <input type="checkbox" checked disabled />
                        <span class="slider"></span>
                    </div>
                </div>
            </div>
            <div class="consent-option">
                <div class="option-info">
                    <h4>Cookies de analíticas</h4>
                    <p>Nos ayudan a entender cómo los visitantes interactúan con la página, como el número de visitantes y la fuente del tráfico.</p>
                </div>
                <div class="toggle-container">
                    <label class="toggle">
                        <input type="checkbox" id="analytics-toggle" checked disabled />
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            <div class="consent-option">
                <div class="option-info">
                    <h4>Cookies de publicidad</h4>
                    <p>Utilizadas para rastrear a los visitantes a través de los sitios web con el fin de mostrar anuncios relevantes y atractivos.</p>
                </div>
                <div class="toggle-container">
                    <label class="toggle">
                        <input type="checkbox" id="ad-toggle" checked />
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>
        <div class="flex justify-end mt-6">
            <button id="save-consent" class="btn btn-accept">Guardar mis elecciones</button>
        </div>
    </div>
  </div>


  <script>
    // Tu código JavaScript existente
    const firebaseConfig = {
      apiKey: "AIzaSyDHxFawAx3IStuZefZtOj_yYRMCDj5V-Rk",
      authDomain: "formiik-dev.firebaseapp.com",
      projectId: "formiik-dev",
      storageBucket: "formiik-dev.firebasestorage.app",
      messagingSenderId: "91782576906",
      appId: "1:91782576906:web:f95afdbe0f80bfa58758f3",
      // measurementId está definido en el script de GA
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    // Ya no necesitas inicializar analytics aquí, se inicializa con la etiqueta gtag.js

    const menuButton = document.getElementById('menu-button');
    const closeButton = document.getElementById('close-button');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebar-overlay');
    const catalogGrid = document.getElementById('catalog-grid');
    const filterContainer = document.getElementById('filter-container');
    const whatsappButton = document.getElementById('whatsapp-contact-button');
    const sidebarLinks = document.querySelectorAll('.sidebar-link');

    let catalogosData = [];
    let iso;
    let filters = {
        brand: '*',
        category: '*'
    };
    function closeSidebar() {
        sidebar.classList.add('-translate-x-full');
        sidebarOverlay.classList.add('hidden');
    }

    menuButton.addEventListener('click', () => {
      sidebar.classList.remove('-translate-x-full');
      sidebarOverlay.classList.remove('hidden');
    });
    closeButton.addEventListener('click', () => {
        closeSidebar();
    });
    sidebarOverlay.addEventListener('click', () => {
        closeSidebar();
    });
    // Función para enviar eventos de GA, revisada para usar gtag
    function registerCardClickEvent(eventName, catalogo) {
      gtag('event', eventName, { 
        'event_category': 'catalogo',
        'event_action': 'click_card',
        'event_label': catalogo.nombre,
        'brand': catalogo.marca
      });
    }

    // Función para el evento de contacto, también revisada para gtag
    function registerWhatsappClickEvent() {
      gtag('event', 'whatsapp_click', {
        'event_category': 'contacto',
        'event_action': 'click_whatsapp'
      });
    }

    whatsappButton.addEventListener('click', (e) => {
      registerWhatsappClickEvent();
    });
    function applyFilters() {
        let combinedFilter;
        if (filters.brand === '*' && filters.category === '*') {
            combinedFilter = '*';
        } else if (filters.brand === '*') {
            combinedFilter = filters.category;
        } else if (filters.category === '*') {
            combinedFilter = filters.brand;
        } else {
            combinedFilter = filters.brand + filters.category;
        }

        if (iso) {
            iso.arrange({ filter: combinedFilter });
            updateUrlParameter(filters.brand, filters.category);
        }
    }
    
    function displayCatalogos() {
        const grid = document.getElementById('catalog-grid');
        catalogosData.forEach(catalogo => {
            const categoryClasses = catalogo.categoria.map(cat => cat.replace(/\s+/g, '-').toLowerCase()).join(' ');
            
            const card = document.createElement('a');
            card.href = catalogo.url;
            card.target = "_blank";
            card.className = `group rounded-lg shadow-md hover:shadow-lg transition-transform hover:scale-105 duration-300 bg-md-surface flex flex-col overflow-hidden catalog-item ${catalogo.marca.replace(/\s+/g, '-').toLowerCase()} ${categoryClasses}`;
            
            if (catalogo.evento_ga) {
                card.addEventListener('click', () => {
                    registerCardClickEvent(catalogo.evento_ga, catalogo);
                });
            }

            const imageWrapper = document.createElement('div');
            imageWrapper.className = "relative w-full overflow-hidden";
            const image = document.createElement('img');
            image.src = catalogo.imagen;
            image.alt = `Portada de ${catalogo.nombre}`;
            image.className = "w-full h-full object-cover transition-transform duration-300 object-top";
            imageWrapper.appendChild(image);

            const textContainer = document.createElement('div');
            textContainer.className = "p-3 flex-grow text-center flex flex-col items-center";
            const title = document.createElement('h3');
            title.textContent = catalogo.nombre;
            title.className = "text-md font-bold font-oswald text-md-on-surface"; 
            textContainer.appendChild(title);

            card.appendChild(imageWrapper);
            card.appendChild(textContainer);
            grid.appendChild(card);
        });
        iso = new Isotope(grid, {
            itemSelector: '.catalog-item',
            layoutMode: 'masonry',
            masonry: {
                columnWidth: '.catalog-item',
                gutter: 16
            },
            getSortData: {
                name: '.font-oswald'
            },
            sortBy: 'name'
        });
        imagesLoaded(grid).on('progress', function() {
            iso.layout();
            checkUrlFilter();
        });
    }

    function createFilterButtons(brands) {
        const allButton = document.createElement('button');
        allButton.textContent = 'Todo';
        allButton.className = 'filter-button active';
        allButton.dataset.filter = '*';
        filterContainer.appendChild(allButton);
        brands.forEach(brand => {
            const button = document.createElement('button');
            button.textContent = brand;
            button.className = 'filter-button';
            button.dataset.filter = `.${brand.replace(/\s+/g, '-').toLowerCase()}`;
            filterContainer.appendChild(button);
        });
        filterContainer.addEventListener('click', (event) => {
            if (event.target.classList.contains('filter-button')) {
                document.querySelectorAll('.filter-button').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
                filters.brand = event.target.dataset.filter;
                applyFilters();
            }
        });
    }

    function checkUrlFilter() {
        const urlParams = new URLSearchParams(window.location.search);
        const brandFromUrl = urlParams.get('brand');
        const categoryFromUrl = urlParams.get('category');

        if (brandFromUrl) {
            const filterButton = document.querySelector(`.filter-button[data-filter=".${brandFromUrl}"]`);
            if (filterButton) {
                document.querySelectorAll('.filter-button').forEach(btn => btn.classList.remove('active'));
                filterButton.classList.add('active');
                filters.brand = `.${brandFromUrl}`;
            }
        }

        if (categoryFromUrl) {
            const sidebarLink = document.querySelector(`.sidebar-link[data-filter=".${categoryFromUrl}"]`);
            if (sidebarLink) {
                sidebarLinks.forEach(l => l.classList.remove('active'));
                sidebarLink.classList.add('active');
                filters.category = `.${categoryFromUrl}`;
            }
        }
        
        if (iso) {
            applyFilters();
        }
    }

    function updateUrlParameter(brandName, categoryName) {
      const urlParams = new URLSearchParams(window.location.search);
      if (brandName === '*') {
          urlParams.delete('brand');
      } else {
          urlParams.set('brand', brandName.replace('.', ''));
      }

      if (categoryName === '*') {
          urlParams.delete('category');
      } else {
          urlParams.set('category', categoryName.replace('.', ''));
      }
      
      const newUrl = `${window.location.origin}${window.location.pathname}?${urlParams.toString()}`;
      window.history.replaceState({path: newUrl}, '', newUrl);
    }
    
    async function fetchCatalogos() {
        try {
            const catalogosRef = db.collection('catalogo');
            const snapshot = await catalogosRef.get();
            catalogosData = [];
            snapshot.forEach(doc => {
                catalogosData.push(doc.data());
            });
            catalogosData.sort((a, b) => a.nombre.localeCompare(b.nombre));

            const brands = [...new Set(catalogosData.map(item => item.marca).filter(Boolean))].sort();

            createFilterButtons(brands);

            displayCatalogos();
        } catch (error) {
            console.error("Error fetching documents: ", error);
        }
    }

    sidebarLinks.forEach(link => {
        link.addEventListener('click', (event) => {
            event.preventDefault(); 
            sidebarLinks.forEach(l => l.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            const categoryValue = event.currentTarget.dataset.filter;
            filters.category = categoryValue;
            applyFilters();
            
            closeSidebar();
        });
    });
    document.addEventListener('DOMContentLoaded', fetchCatalogos);

    // COMIENZO: LÓGICA DEL BANNER DE CONSENTIMIENTO
    const consentBanner = document.getElementById('consent-banner');
    const acceptAllButton = document.getElementById('accept-all-cookies');
    const openModalButton = document.getElementById('open-consent-modal');
    const consentModal = document.getElementById('consent-modal');
    const closeModalButton = document.getElementById('close-modal');
    const saveConsentButton = document.getElementById('save-consent');
    const analyticsToggle = document.getElementById('analytics-toggle');
    const adToggle = document.getElementById('ad-toggle');

    function checkConsent() {
      const storedConsent = localStorage.getItem('cookie_consent');
      if (storedConsent) {
        const consent = JSON.parse(storedConsent);
        gtag('consent', 'update', {
          'ad_storage': consent.ad_storage,
          'analytics_storage': consent.analytics_storage
        });
        analyticsToggle.checked = consent.analytics_storage === 'granted';
        adToggle.checked = consent.ad_storage === 'granted';
        consentBanner.classList.remove('show');
      } else {
        // Muestra el banner si no hay consentimiento guardado
        setTimeout(() => {
          consentBanner.classList.add('show');
        }, 3000);
      }
    }

    function handleAcceptAll() {
      const consent = {
        analytics_storage: 'granted',
        ad_storage: 'granted'
      };
      gtag('consent', 'update', consent);
      localStorage.setItem('cookie_consent', JSON.stringify(consent));
      consentBanner.classList.remove('show');
      console.log('Consentimiento total aceptado. Google Analytics y publicidad habilitados.');
    }

    function handleSaveConsent() {
        const analyticsGranted = analyticsToggle.checked ? 'granted' : 'denied';
        const adGranted = adToggle.checked ? 'granted' : 'denied';

        const consent = {
            analytics_storage: analyticsGranted,
            ad_storage: adGranted
        };

        gtag('consent', 'update', consent);
        localStorage.setItem('cookie_consent', JSON.stringify(consent));
        consentModal.classList.remove('show');
        consentBanner.classList.remove('show');
        console.log('Consentimiento guardado. Analytics:', analyticsGranted, 'Publicidad:', adGranted);
    }
    
    function handleOpenModal() {
        consentBanner.classList.remove('show');
        consentModal.classList.add('show');
    }

    function handleCloseModal() {
        consentModal.classList.remove('show');
        checkConsent(); // Vuelve a mostrar el banner si no hay consentimiento guardado
    }

    acceptAllButton.addEventListener('click', handleAcceptAll);
    openModalButton.addEventListener('click', handleOpenModal);
    closeModalButton.addEventListener('click', handleCloseModal);
    saveConsentButton.addEventListener('click', handleSaveConsent);

    document.addEventListener('DOMContentLoaded', checkConsent);
    // FIN: LÓGICA DEL BANNER DE CONSENTIMIENTO
  </script>
</body>
</html>
