<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="Aliy's Store | Venta por catálogo" />
  <meta property="og:description" content="Hola, soy Alicia y te ayudo a encontrar el producto perfecto para ti" />
  <meta property="og:image" content="https://aliysstore.github.io/Aliy-s-Store/img/perfil.jpg" />
  <meta property="og:url" content="https://aliysstore.github.io/Aliy-s-Store" />
  <meta property="og:type" content="website" />
  
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Aliy's Store | Venta por catálogo" />
  <meta name="twitter:description" content="Hola, soy Alicia y te ayudo a encontrar el producto perfecto para ti" />
  <meta name="twitter:image" content="https://aliysstore.github.io/Aliy-s-Store/img/perfil.jpg" />
    
  <meta name="google-site-verification" content="OJZCwNFA7qoGBq9oi98SAslM7bHUFF-6A_8wYiELeVU" />
  
  <title>Aliy's Store | Calzado, ropa y accesorios por catálogo</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&family=Oswald:wght@400;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="img/favicon.ico" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Shuffle/6.0.0/shuffle.min.js"></script>
  <script src="https://unpkg.com/imagesloaded@5/imagesloaded.pkgd.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('consent', 'default', {
      'ad_storage': 'granted',
      'analytics_storage': 'granted',
      'wait_for_update': 500
    });
  </script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZW7YPM60FN"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-ZW7YPM60FN', {
        'allow_google_signals': true
    });
  </script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'md-primary': '#FF5277',
            'md-on-primary': '#FFFFFF',
            'md-primary-container': '#FFD9E2',
            'md-on-primary-container': '#660021',
            'md-secondary': '#5B4F7B',
            'md-on-secondary': '#FFFFFF',
            'md-secondary-container': '#E2D9FF',
            'md-on-secondary-container': '#1C0D37',
            'md-background': '#FFFBFE',
            'md-on-background': '#1D1B1F',
            'md-surface': '#FFFBFE',
            'md-on-surface': '#1D1B1F',
            'md-surface-variant': '#F3DDE3',
            'md-on-surface-variant': '#504147',
            'md-outline': '#837078',
            'md-surface-container-high': '#ECE6F0',
          },
          fontFamily: {
            'nunito': ['Nunito', 'sans-serif'],
            'oswald': ['Oswald', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <style>
    .catalog-grid {
      position: relative;
      
    }
    .catalog-item {
      width: calc(50% - 16px);
      margin: 8px;
      transition: transform 0.4s ease-out, opacity 0.4s ease-out;
    }
    /* ¡CAMBIO! Clase para elementos ocultos de Shuffle */
    .catalog-item.hidden {
      opacity: 0;
      transform: scale(0.001) translateY(50px);
    }
    #catalog-grid {
      visibility: hidden;
    }
    @media (min-width: 640px) {
       .catalog-item {
         width: calc(33.333% - 16px);
       }
    }
    @media (min-width: 1024px) {
       .catalog-item {
         width: calc(25% - 16px);
       }
    }
    @media (min-width: 1280px) {
       .catalog-item {
         width: calc(20% - 16px);
       }
    }
    @media (min-width: 1536px) {
       .catalog-item {
         width: calc(16.666% - 16px);
       }
    }
    .catalog-item .h-full {
      min-height: 250px;
    }
    .new-ribbon-wrapper {
        position: absolute;
        top: 0;
        right: 0;
        overflow: hidden;
        width: 100px;
        height: 100px;
        z-index: 10;
    }
    .new-ribbon-wrapper span {
        position: absolute;
        top: 20px;
        right: -30px;
        width: 120px;
        text-align: center;
        text-transform: uppercase;
        font-weight: bold;
        padding: 5px 0;
        background-color: #FF5277;
        color: #FFFFFF;
        transform: rotate(45deg);
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
    }
    .filter-button {
      padding: 8px 16px;
      border-radius: 9999px;
      font-weight: bold;
      transition: all 0.3s ease;
      background-color: transparent;
      border: 1px solid #837078;
      color: #504147;
    }
    .filter-button.active, .filter-button:hover {
      background-color: #FF5277;
      border-color: #FF5277;
      color: #FFFFFF;
    }
    .sidebar-link {
      padding: 8px 12px;
      border-radius: 8px;
      transition: all 0.3s ease;
      background-color: transparent;
      color: #504147;
      border: 1px solid transparent;
    }
    .sidebar-link.active, .sidebar-link:hover {
      background-color: #FF5277;
      color: #FFFFFF;
    }
    .consent-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      background-color: #1d1b1f;
      color: #fffafe;
      padding: 1.5rem;
      box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.2);
      transform: translateY(100%);
      transition: transform 0.5s ease-in-out;
    }
    .consent-banner.show {
      transform: translateY(0);
    }
    .consent-banner .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 9999px;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }
    .consent-banner .btn-accept {
      background-color: #FF5277;
      color: #FFFFFF;
      border: 1px solid #FF5277;
    }
    .consent-banner .btn-accept:hover {
      background-color: #C63A5E;
    }
    .consent-banner .btn-deny {
      background-color: transparent;
      color: #FFFFFF;
      border: 1px solid #FFFFFF;
    }
    .consent-banner .btn-deny:hover {
      background-color: #ffffff33;
    }
    .consent-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
        z-index: 1001;
        justify-content: center;
        align-items: center;
    }
    .consent-modal.show {
        display: flex;
    }
    .consent-modal-content {
        background-color: #fff;
        padding: 2rem;
        border-radius: 12px;
        width: 90%;
        max-width: 500px;
        color: #1d1b1f;
        position: relative;
        max-height: 80vh;
        display: flex;
        flex-direction: column;
    }
    .consent-modal-content h3 {
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 1rem;
    }
    .consent-modal-content p {
        margin-bottom: 1.5rem;
    }
    .consent-modal-content .close-btn {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.5rem;
        cursor: pointer;
    }
    .consent-options {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        overflow-y: auto;
        padding-right: 0.5rem;
    }
    .consent-option {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
    }
    .consent-option .option-info {
        display: flex;
        flex-direction: column;
        flex-grow: 1;
    }
    .consent-option .option-info h4 {
        font-weight: bold;
    }
    .consent-option .option-info p {
        font-size: 0.875rem;
        color: #504147;
    }
    .consent-option .toggle-container {
        margin-left: 1rem;
    }
    .consent-option .toggle {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
    }
    .consent-option .toggle input {
        opacity: 0;
        width: 0;
        height: 0;
    }
    .consent-option .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 34px;
    }
    .consent-option .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }
    .consent-option input:checked + .slider {
        background-color: #FF5277;
    }
    .consent-option input:focus + .slider {
        box-shadow: 0 0 1px #FF5277;
    }
    .consent-option input:checked + .slider:before {
        transform: translateX(26px);
    }
    /* Estilos para el modal de catálogo */
    .catalog-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
        z-index: 1002;
        justify-content: center;
        align-items: center;
    }
    .catalog-modal.show {
        display: flex;
    }
    .catalog-modal-content {
        background-color: #fff;
        padding: 1.5rem;
        border-radius: 12px;
        width: 90%;
        max-width: 400px;
        color: #1d1b1f;
        position: relative;
        text-align: center;
    }
    .catalog-modal-image {
        width: 100%;
        height: auto;
        border-radius: 8px;
        margin-bottom: 1rem;
    }
  </style>
</head>
<body class="bg-md-background font-nunito text-md-on-background">
  <div class="flex flex-col min-h-screen">
    <header class="bg-md-surface-variant p-5 flex justify-between items-center">
      <div class="md:hidden">
        <button id="menu-button" class="text-md-on-surface-variant">
          <i class="fas fa-bars text-xl"></i>
        </button>
      </div>
      <div class="flex items-center space-x-2">
        <span class="md:hidden text-2xl font-oswald font-bold text-md-on-surface-variant">Aliy's Store</span>
        <span class="hidden md:block text-2xl font-oswald font-bold text-md-on-surface-variant">Aliy's Store | Venta por catálogo</span>
      </div>
      <a href="https://wa.me/5212285722185" id="whatsapp-contact-button" class="bg-transparent border border-md-outline text-md-on-surface-variant hover:bg-md-primary-container hover:text-md-on-primary-container active:bg-pink-100 font-bold py-2 px-4 rounded-full transition duration-300 flex items-center space-x-2">
        <i class="fab fa-whatsapp text-lg"></i>
        <span>Contacto</span>
      </a>
    </header>
    <div class="flex flex-col md:flex-row flex-grow">
      <div id="sidebar-overlay" class="fixed inset-0 bg-md-surface/50 hidden z-40 md:hidden"></div>
      <aside id="sidebar" class="bg-md-surface-variant p-5 flex-shrink-0 z-50 fixed inset-y-0 left-0 w-64 transform -translate-x-full transition-transform duration-300 md:relative md:w-48 md:transform-none md:block">
        <div class="text-right md:hidden">
            <button id="close-button" class="text-md-on-surface-variant">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <nav class="mt-8">
          <ul class="space-y-4">
            <li>
              <a href="#" class="sidebar-link block flex items-center space-x-2 active" data-filter="all">
                <i class="fas fa-th-large"></i>
                <span>Todo</span>
              </a>
            </li>
            <li>
              <a href="#" class="sidebar-link block flex items-center space-x-2" data-filter="calzado">
                <i class="fas fa-shoe-prints"></i>
                <span>Calzado</span>
              </a>
              <ul class="ml-4 mt-2 space-y-2">
                <li><a href="#" class="sidebar-link block flex items-center space-x-2" data-filter="dama"><i class="fas fa-female"></i><span>Dama</span></a></li>
                <li><a href="#" class="sidebar-link block flex items-center space-x-2" data-filter="caballeros"><i class="fas fa-male"></i><span>Caballeros</span></a></li>
                <li><a href="#" class="sidebar-link block flex items-center space-x-2" data-filter="niños"><i class="fas fa-child"></i><span>Niños</span></a></li>
                <li><a href="#" class="sidebar-link block flex items-center space-x-2" data-filter="outlet"><i class="fas fa-tag"></i><span>Outlet</span></a></li>
              </ul>
            </li>
            <li>
              <a href="#" class="sidebar-link block flex items-center space-x-2" data-filter="ropa">
                <i class="fas fa-tshirt"></i>
                <span>Ropa</span>
              </a>
            </li>
            <li>
              <a href="#" class="sidebar-link block flex items-center space-x-2" data-filter="accesorios">
                <i class="fas fa-hat-cowboy"></i>
                <span>Accesorios</span>
              </a>
            </li>
            <li>
              <a href="#" class="sidebar-link block flex items-center space-x-2" data-filter="hogar">
                <i class="fas fa-house"></i>
                <span>Hogar</span>
              </a>
            </li>
            <li>
              <a href="#" class="sidebar-link block flex items-center space-x-2" data-filter="belleza-y-fragancias">
                <i class="fas fa-spa"></i>
                <span>Belleza y fragancias</span>
              </a>
            </li>
            <li>
              <a href="#" class="sidebar-link block flex items-center space-x-2" data-filter="catalogos-especiales">
                <i class="fas fa-book-open"></i>
                <span>Catálogos especiales</span>
              </a>
            </li>
          </ul>
        </nav>
      </aside>
      <main class="flex-grow bg-md-background">
        <section id="status-messages" class="p-5">
          <div id="loading-state" class="flex flex-col items-center justify-center min-h-[50vh]">
            <i class="fas fa-spinner fa-spin text-4xl text-md-primary"></i>
            <p class="mt-4 text-md-on-surface-variant text-lg">Cargando catálogo...</p>
          </div>
  
          <div id="error-state" class="hidden flex flex-col items-center justify-center min-h-[50vh] text-center">
              <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
              <p class="text-md-on-surface-variant text-lg">No pudimos cargar el catálogo. Por favor, revisa tu conexión a internet.</p>
              <button id="retry-button" class="mt-4 bg-md-primary text-md-on-primary hover:bg-md-primary-container hover:text-md-on-primary-container font-bold py-2 px-6 rounded-full transition duration-300">
                  Intentar de nuevo
              </button>
          </div>
        </section>

        <section id="catalog-content" class="hidden">
          <div id="filter-container" class="mb-8 flex flex-wrap gap-2 justify-center">
          </div>
          <div id="catalog-grid" class="catalog-grid flex flex-wrap gap-4">
          </div>
          
          <div id="no-results-state" class="hidden flex flex-col items-center justify-center min-h-[50vh] text-center">
            <i class="fas fa-search-minus text-6xl text-md-primary-container mb-6"></i>
            <p class="text-md-on-surface-variant text-lg">No se encontraron productos que coincidan con tu búsqueda.</p>
            <p class="text-md-on-surface-variant text-md mt-2">Intenta cambiando los filtros.</p>
          </div>
        </section>
      </main>
    </div>
    <footer class="bg-md-surface-container-high p-5 text-center text-md-on-surface-variant">
      Aliy's Store &copy; 2024. Todos los derechos reservados.
    </footer>
  </div>

  <div id="consent-banner" class="consent-banner">
    <div class="max-w-4xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
      <p class="text-sm text-center md:text-left">
        Este sitio utiliza cookies para mejorar la experiencia del usuario y analizar el tráfico.
        <a href="aviso-de-privacidad.html" class="underline font-bold" id="link-politica-cookies">Política de cookies</a>.
      </p>
      <div class="flex gap-4">
        <button id="accept-all-cookies" class="btn btn-accept">Aceptar todas</button>
        <button id="open-consent-modal" class="btn btn-deny">Configurar</button>
      </div>
    </div>
  </div>

  <div id="consent-modal" class="consent-modal">
    <div class="consent-modal-content">
        <span class="close-btn" id="close-modal">&times;</span>
        <h3>Configuración de privacidad</h3>
        <p>Selecciona qué tipos de cookies deseas aceptar. Los cambios se aplicarán a tu próxima visita.</p>
        <div class="consent-options">
            <div class="consent-option">
                <div class="option-info">
                    <h4>Cookies necesarias</h4>
                    <p>Necesarias para el funcionamiento básico del sitio. No se pueden desactivar.</p>
                </div>
                <div class="toggle-container">
                    <div class="toggle">
                        <input type="checkbox" checked disabled />
                        <span class="slider"></span>
                    </div>
                </div>
            </div>
            <div class="consent-option">
                <div class="option-info">
                    <h4>Cookies de analíticas</h4>
                    <p>Nos ayudan a entender cómo los visitantes interactúan con la página, como el número de visitantes y la fuente del tráfico.</p>
                </div>
                <div class="toggle-container">
                    <label class="toggle">
                        <input type="checkbox" id="analytics-toggle" checked disabled />
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            <div class="consent-option">
                <div class="option-info">
                    <h4>Cookies de publicidad</h4>
                    <p>Utilizadas para rastrear a los visitantes a través de los sitios web con el fin de mostrar anuncios relevantes y atractivos.</p>
                </div>
                <div class="toggle-container">
                    <label class="toggle">
                        <input type="checkbox" id="ad-toggle" checked />
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>
        <div class="flex justify-end mt-6">
            <button id="save-consent" class="btn btn-accept">Guardar mis elecciones</button>
        </div>
    </div>
  </div>

  <div id="catalog-modal" class="catalog-modal">
    <div class="catalog-modal-content">
      <span class="close-btn" id="close-catalog-modal">&times;</span>
      <img id="modal-image" class="catalog-modal-image" src="" alt="Portada del catálogo">
      <h3 id="modal-title" class="text-xl font-bold font-oswald text-md-on-surface"></h3>
      <a id="modal-button" href="#" target="_blank" class="mt-4 bg-md-primary text-md-on-primary hover:bg-md-primary-container hover:text-md-on-primary-container font-bold py-2 px-6 rounded-full transition duration-300 inline-block">
        Ver Catálogo
      </a>
    </div>
  </div>

  <div id="not-found-modal" class="catalog-modal">
      <div class="catalog-modal-content">
          <span class="close-btn" id="close-not-found-modal">&times;</span>
          <i class="fas fa-exclamation-circle text-4xl text-yellow-500 mb-4"></i>
          <h3 class="text-xl font-bold font-oswald text-md-on-surface">Catálogo no encontrado</h3>
          <p class="mt-2 text-md-on-surface-variant">El enlace del catálogo que intentas ver no es válido o ha sido retirado.</p>
          <button id="close-not-found-button" class="mt-4 bg-md-primary text-md-on-primary hover:bg-md-primary-container hover:text-md-on-primary-container font-bold py-2 px-6 rounded-full transition duration-300">
              Aceptar
          </button>
      </div>
  </div>


  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDHxFawAx3IStuZefZtOj_yYRMCDj5V-Rk",
      authDomain: "formiik-dev.firebaseapp.com",
      projectId: "formiik-dev",
      storageBucket: "formiik-dev.firebasestorage.app",
      messagingSenderId: "91782576906",
      appId: "1:91782576906:web:f95afdbe0f80bfa58758f3",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const menuButton = document.getElementById('menu-button');
    const closeButton = document.getElementById('close-button');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebar-overlay');
    const catalogGrid = document.getElementById('catalog-grid');
    const filterContainer = document.getElementById('filter-container');
    const whatsappButton = document.getElementById('whatsapp-contact-button');
    const sidebarLinks = document.querySelectorAll('.sidebar-link');
    
    const loadingState = document.getElementById('loading-state');
    const errorState = document.getElementById('error-state');
    const noResultsState = document.getElementById('no-results-state');
    const retryButton = document.getElementById('retry-button');
    const contentContainer = document.getElementById('catalog-content');

    const catalogModal = document.getElementById('catalog-modal');
    const closeCatalogModal = document.getElementById('close-catalog-modal');
    const modalImage = document.getElementById('modal-image');
    const modalTitle = document.getElementById('modal-title');
    const modalButton = document.getElementById('modal-button');

    const notFoundModal = document.getElementById('not-found-modal');
    const closeNotFoundModal = document.getElementById('close-not-found-modal');
    const closeNotFoundButton = document.getElementById('close-not-found-button');

    let catalogosData = [];
    // ¡CAMBIO! Variable para la instancia de Shuffle
    let shuffleInstance; 
    let filters = {
        brand: 'all',
        category: 'all'
    };
    function closeSidebar() {
        sidebar.classList.add('-translate-x-full');
        sidebarOverlay.classList.add('hidden');
    }

    menuButton.addEventListener('click', () => {
      sidebar.classList.remove('-translate-x-full');
      sidebarOverlay.classList.remove('hidden');
    });
    closeButton.addEventListener('click', () => {
        closeSidebar();
    });
    sidebarOverlay.addEventListener('click', () => {
        closeSidebar();
    });

    function registerCardClickEvent(eventName, catalogo) {
      gtag('event', eventName, { 
        'event_category': 'catalogo',
        'event_action': 'click_card',
        'event_label': catalogo.nombre,
        'brand': catalogo.marca
      });
    }

    function registerWhatsappClickEvent() {
      gtag('event', 'whatsapp_click', {
        'event_category': 'contacto',
        'event_action': 'click_whatsapp'
      });
    }

    whatsappButton.addEventListener('click', (e) => {
      registerWhatsappClickEvent();
    });
    
    // ¡CAMBIO! Lógica de filtros actualizada para Shuffle.js
    /*function applyFilters() {
      let combinedFilter;
      const brandFilter = filters.brand === 'all' ? null : filters.brand;
      const categoryFilter = filters.category === 'all' ? null : filters.category;

      if (brandFilter && categoryFilter) {
          combinedFilter = Shuffle.Filtered.and([brandFilter, categoryFilter]);
      } else if (brandFilter) {
          combinedFilter = brandFilter;
      } else if (categoryFilter) {
          combinedFilter = categoryFilter;
      } else {
          combinedFilter = Shuffle.ALL_ITEMS;
      }

      if (shuffleInstance) {
        shuffleInstance.filter(combinedFilter);
        shuffleInstance.layout();
        updateUrlParameter(filters.brand, filters.category);
      }
    }*/
    
    function applyFilters() {
      shuffleInstance.filter((element) => {
        const brandFilter = filters.brand === 'all' ? null : filters.brand;
        const categoryFilter = filters.category === 'all' ? null : filters.category;
        const elementGroups = JSON.parse(element.getAttribute('data-groups'));
    
        if (brandFilter && !elementGroups.includes(brandFilter)) {
          return false;
        }
    
        if (categoryFilter && !elementGroups.includes(categoryFilter)) {
          return false;
        }
    
        return true;
      });
    
      shuffleInstance.layout();
      checkEmptyShuffle();
    } 
    
    // ¡CAMBIO! Lógica para manejar resultados vacíos
    function checkEmptyShuffle() {
      if (shuffleInstance) {
        if (shuffleInstance.visibleItems.length === 0) {
          noResultsState.classList.remove('hidden');
          catalogGrid.classList.add('hidden');
        } else {
          noResultsState.classList.add('hidden');
          catalogGrid.classList.remove('hidden');
        }
      }
    }

    function displayCatalogos() {
        const grid = document.getElementById('catalog-grid');
        grid.innerHTML = '';
        if (catalogosData.length === 0) {
            noResultsState.classList.remove('hidden');
            catalogGrid.classList.add('hidden');
            return;
        } else {
            noResultsState.classList.add('hidden');
            catalogGrid.classList.remove('hidden');
        }

        catalogosData.forEach(catalogo => {
            const categoryClasses = catalogo.categoria.map(cat => cat.replace(/\s+/g, '-').toLowerCase());
            const brandClass = catalogo.marca.replace(/\s+/g, '-').toLowerCase();
            const allClasses = [brandClass, ...categoryClasses];

            const card = document.createElement('a');
            card.href = catalogo.url;
            card.target = "_blank";
            // ¡CAMBIO! Las clases de filtro se añaden al atributo data-groups
            card.className = 'group rounded-lg shadow-md hover:shadow-lg transition-transform hover:scale-105 duration-300 bg-md-surface flex flex-col overflow-hidden catalog-item';
            card.setAttribute("data-groups", JSON.stringify(allClasses));
            
            if (catalogo.prioridad !== undefined) {
                card.setAttribute("data-prioridad", catalogo.prioridad);
            } else {
                card.setAttribute("data-prioridad", 9999);
            }
    
            if (catalogo.evento_ga) {
                card.addEventListener('click', () => {
                    registerCardClickEvent(catalogo.evento_ga, catalogo);
                });
            }
    
            const imageWrapper = document.createElement('div');
            imageWrapper.className = "relative w-full overflow-hidden";
            const image = document.createElement('img');
            image.src = catalogo.imagen;
            image.alt = 'Portada de ${catalogo.nombre}';
            image.className = "w-full h-full object-cover transition-transform duration-300 object-top";
            imageWrapper.appendChild(image);
    
            const textContainer = document.createElement('div');
            textContainer.className = "p-3 flex-grow text-center flex flex-col items-center";
            const title = document.createElement('h3');
            title.textContent = catalogo.nombre;
            title.className = "text-md font-bold font-oswald text-md-on-surface"; 
            textContainer.appendChild(title);
    
            card.appendChild(imageWrapper);
            card.appendChild(textContainer);
            grid.appendChild(card);
        });
    
        // ¡CAMBIO! Inicialización de Shuffle
        if (shuffleInstance) {
          shuffleInstance.destroy();
        }

        shuffleInstance = new Shuffle(grid, {
          itemSelector: '.catalog-item',
          initialSort: {
            by: (element) => {
              const prioridad = parseInt(element.getAttribute('data-prioridad'));
              const nombre = element.querySelector('h3').textContent;
              return `${prioridad.toString().padStart(10, '0')}_${nombre}`;
            },
            reverse: false
          }
        });
        
        // ¡CAMBIO! Evento de Shuffle para manejar el fin de la animación
        shuffleInstance.on(Shuffle.EventType.LAYOUT, checkEmptyShuffle);
    
        imagesLoaded(grid).on('always', function() {
            grid.style.visibility = 'visible';
            shuffleInstance.layout();
            checkUrlFilter();
        });
    }

    function createFilterButtons(brands) {
        filterContainer.innerHTML = '';
        const allButton = document.createElement('button');
        allButton.textContent = 'Todo';
        allButton.className = 'filter-button active';
        allButton.dataset.filter = 'all';
        filterContainer.appendChild(allButton);
        brands.forEach(brand => {
            const button = document.createElement('button');
            button.textContent = brand;
            button.className = 'filter-button';
            // ¡CAMBIO! El valor del filtro es la clase de CSS, no el selector
            button.dataset.filter = brand.replace(/\s+/g, '-').toLowerCase(); 
            filterContainer.appendChild(button);
        });
        filterContainer.addEventListener('click', (event) => {
            if (event.target.classList.contains('filter-button')) {
                document.querySelectorAll('.filter-button').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
                filters.brand = event.target.dataset.filter;
                applyFilters();
            }
        });
    }

    function checkUrlFilter() {
        const urlParams = new URLSearchParams(window.location.search);
        const brandFromUrl = urlParams.get('brand');
        const categoryFromUrl = urlParams.get('category');

        if (brandFromUrl) {
            const filterButton = document.querySelector('.filter-button[data-filter="${brandFromUrl}"]');
            if (filterButton) {
                document.querySelectorAll('.filter-button').forEach(btn => btn.classList.remove('active'));
                filterButton.classList.add('active');
                filters.brand = brandFromUrl;
            }
        }

        if (categoryFromUrl) {
            const sidebarLink = document.querySelector('.sidebar-link[data-filter="${categoryFromUrl}"]');
            if (sidebarLink) {
                sidebarLinks.forEach(l => l.classList.remove('active'));
                sidebarLink.classList.add('active');
                filters.category = categoryFromUrl;
            }
        }
        
        if (shuffleInstance) {
            applyFilters();
        }
    }

    function updateUrlParameter(brandName, categoryName) {
      const urlParams = new URLSearchParams(window.location.search);
      if (brandName === 'all') {
          urlParams.delete('brand');
      } else {
          urlParams.set('brand', brandName);
      }

      if (categoryName === 'all') {
          urlParams.delete('category');
      } else {
          urlParams.set('category', categoryName);
      }
      
      const newUrl = '${window.location.origin}${window.location.pathname}?${urlParams.toString()}';
      window.history.replaceState({path: newUrl}, '', newUrl);
    }
    
    async function fetchCatalogos() {
        loadingState.classList.remove('hidden');
        errorState.classList.add('hidden');
        noResultsState.classList.add('hidden');
        contentContainer.classList.add('hidden');
        catalogGrid.style.visibility = 'hidden';

        try {
            const catalogosRef = db.collection('catalogo');
            const snapshot = await catalogosRef.get();
            catalogosData = [];
            snapshot.forEach(doc => {
                catalogosData.push(doc.data());
            });
            
            const brands = [...new Set(catalogosData.map(item => item.marca).filter(Boolean))].sort();

            createFilterButtons(brands);
            displayCatalogos();

            loadingState.classList.add('hidden');
            contentContainer.classList.remove('hidden');
            
            checkUrlCatalog();

        } catch (error) {
            console.error("Error fetching documents: ", error);
            loadingState.classList.add('hidden');
            errorState.classList.remove('hidden');
        }
    }

    function checkUrlCatalog() {
      const urlParams = new URLSearchParams(window.location.search);
      const catalogoUrlParam = urlParams.get('catalogo');

      if (catalogoUrlParam) {
        const foundCatalogo = catalogosData.find(c => c.evento_ga === catalogoUrlParam);

        if (foundCatalogo) {
          showCatalogModal(foundCatalogo);
        } else {
          showNotFoundModal();
        }
      }
    }

    function showCatalogModal(catalogo) {
        modalImage.src = catalogo.imagen;
        modalImage.alt = 'Portada de ${catalogo.nombre}';
        modalTitle.textContent = catalogo.nombre;
        modalButton.href = catalogo.url;
        
        modalButton.onclick = () => {
            registerCardClickEvent(catalogo.evento_ga, catalogo);
            hideCatalogModal();
        };

        catalogModal.classList.add('show');
    }

    function hideCatalogModal() {
        catalogModal.classList.remove('show');
    }

    function showNotFoundModal() {
        notFoundModal.classList.add('show');
    }

    function hideNotFoundModal() {
        notFoundModal.classList.remove('show');
    }

    sidebarLinks.forEach(link => {
        link.addEventListener('click', (event) => {
            event.preventDefault(); 
            sidebarLinks.forEach(l => l.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            // ¡CAMBIO! El valor del filtro se toma del data-filter
            const categoryValue = event.currentTarget.dataset.filter;
            filters.category = categoryValue;
            applyFilters();
            
            closeSidebar();
        });
    });

    retryButton.addEventListener('click', fetchCatalogos);
    closeCatalogModal.addEventListener('click', hideCatalogModal);
    closeNotFoundModal.addEventListener('click', hideNotFoundModal);
    closeNotFoundButton.addEventListener('click', hideNotFoundModal);

    document.addEventListener('DOMContentLoaded', fetchCatalogos);

    const consentBanner = document.getElementById('consent-banner');
    const acceptAllButton = document.getElementById('accept-all-cookies');
    const openModalButton = document.getElementById('open-consent-modal');
    const consentModal = document.getElementById('consent-modal');
    const closeModalButton = document.getElementById('close-modal');
    const saveConsentButton = document.getElementById('save-consent');
    const analyticsToggle = document.getElementById('analytics-toggle');
    const adToggle = document.getElementById('ad-toggle');

    function checkConsent() {
      const storedConsent = localStorage.getItem('cookie_consent');
      if (storedConsent) {
        const consent = JSON.parse(storedConsent);
        gtag('consent', 'update', {
          'ad_storage': consent.ad_storage,
          'analytics_storage': consent.analytics_storage
        });
        analyticsToggle.checked = consent.analytics_storage === 'granted';
        adToggle.checked = consent.ad_storage === 'granted';
        consentBanner.classList.remove('show');
      } else {
        setTimeout(() => {
          consentBanner.classList.add('show');
        }, 3000);
      }
    }

    function handleAcceptAll() {
      const consent = {
        analytics_storage: 'granted',
        ad_storage: 'granted'
      };
      gtag('consent', 'update', consent);
      localStorage.setItem('cookie_consent', JSON.stringify(consent));
      consentBanner.classList.remove('show');
      console.log('Consentimiento total aceptado. Google Analytics y publicidad habilitados.');
    }

    function handleSaveConsent() {
        const analyticsGranted = analyticsToggle.checked ? 'granted' : 'denied';
        const adGranted = adToggle.checked ? 'granted' : 'denied';

        const consent = {
            analytics_storage: analyticsGranted,
            ad_storage: adGranted
        };

        gtag('consent', 'update', consent);
        localStorage.setItem('cookie_consent', JSON.stringify(consent));
        consentModal.classList.remove('show');
        consentBanner.classList.remove('show');
        console.log('Consentimiento guardado. Analytics:', analyticsGranted, 'Publicidad:', adGranted);
    }
    
    function handleOpenModal() {
        consentBanner.classList.remove('show');
        consentModal.classList.add('show');
    }

    function handleCloseModal() {
        consentModal.classList.remove('show');
        checkConsent();
    }

    acceptAllButton.addEventListener('click', handleAcceptAll);
    openModalButton.addEventListener('click', handleOpenModal);
    closeModalButton.addEventListener('click', handleCloseModal);
    saveConsentButton.addEventListener('click', handleSaveConsent);

    document.addEventListener('DOMContentLoaded', fetchCatalogos);
  </script>
</body>
</html>
